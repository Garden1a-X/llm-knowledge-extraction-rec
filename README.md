# 基于电影海报视觉知识提取的推荐系统

## 项目简介

本项目旨在利用**多模态大语言模型**（如GPT-4V、Claude 3.5 Sonnet）从**电影海报**中提取视觉知识点，构建基于视觉特征的知识图谱，并用于电影推荐。

**核心创新点**：
- 🎨 **从海报提取视觉知识点**：利用多模态LLM分析电影海报的视觉特征（色彩、构图、风格等）
- 📊 利用视觉知识点构建结构化图谱，替代传统的文本标签或ID embedding
- 🔗 构建多结构分离 + 联合融合的图谱建模框架（电影视觉侧、用户兴趣侧、交互侧）
- 🧠 引入边类型感知机制和对比损失，提升基于视觉的用户兴趣建模
- 💡 保留推荐过程的可解释性（基于视觉特征的推荐理由）

**研究重点**：
本项目专注于探索**视觉信息**在推荐系统中的作用，而非传统的文本描述或类型标签。我们相信电影海报包含了丰富的视觉语义信息，能够更直观地反映电影的风格、氛围和主题。

## 数据集

### MovieLens 1M + 电影海报

- **基础数据集**：MovieLens 1M
  - 官方来源：https://grouplens.org/datasets/movielens/1m/
  - 包含6,040用户对3,900部电影的1,000,209条评分

- **🎬 海报数据**：
  - 来源：https://github.com/11Li11/Li/tree/master/ml-1m
  - 感谢 [@11Li11](https://github.com/11Li11) 整理并提供的电影海报图片
  - 海报图片存放在 `posters/` 目录下

- **数据文件结构**：
  ```
  data/raw/ml-1m/
  ├── ratings.dat          # 用户评分记录（UserID::MovieID::Rating::Timestamp）
  ├── users.dat            # 用户人口统计信息（Gender::Age::Occupation::Zip-code）
  ├── movies.dat           # 电影信息（MovieID::Title::Genres）
  └── posters/             # 电影海报图片 (*.jpg)
      ├── 1.jpg           # 电影ID对应的海报
      ├── 2.jpg
      └── ...
  ```

**注：本项目的核心价值在于从海报图片中提取视觉知识，而不是使用文本描述。**

## 技术架构

### 1. 知识图谱构建（离线阶段 - 使用LLM）

构建的图谱包含三个部分：

#### 1.1 电影视觉侧图（从海报提取）
- **结构**：电影 → 视觉知识点
- **输入**：电影海报图片
- **输出**：结构化的视觉知识点

**视觉知识点类型**（预设，可根据实际抽取结果调整）：

| 类型 | 描述 | 示例 |
|------|------|------|
| **Color_Palette** | 色彩风格 | 暖色调、冷色调、高对比、低饱和度 |
| **Visual_Mood** | 视觉氛围 | 温馨、压抑、神秘、欢快、史诗感 |
| **Composition** | 构图风格 | 对称构图、三分法、中心构图、极简主义 |
| **Lighting** | 光影效果 | 强烈对比、柔和光线、剪影、逆光 |
| **Texture** | 质感风格 | 粗粒感、光滑、复古、现代感 |
| **Character_Presentation** | 角色呈现 | 单人特写、群像、无人物、背影 |
| **Era_Style** | 时代风格 | 现代、复古、未来科幻、80年代 |
| **Genre_Visual** | 视觉类型暗示 | 动作片元素、恐怖片元素、爱情片元素 |
| **Typography** | 字体设计 | 粗犷、优雅、手写、科技感 |
| **Others** | 其他视觉特征 | 特殊符号、独特元素 |

**视觉知识抽取流程**：
1. 使用多模态LLM（GPT-4V / Claude 3.5 Sonnet）分析海报图片
2. 提取上述各类视觉特征
3. 每个知识点包含：类型、内容描述、置信度
4. 对知识点内容进行聚类标准化（解决同义表达问题）

#### 1.2 用户视觉偏好侧图
- **结构**：用户 → 视觉偏好标签（长期/短期）
- **生成方式**：
  - 基于用户观看过的电影海报的视觉特征
  - 通过Graph RAG聚合用户历史交互电影的视觉知识点
  - 区分长期稳定的视觉偏好和短期趋势
- **示例**：
  - 长期偏好：该用户偏好"冷色调"、"高对比度"、"科幻元素"的海报
  - 短期趋势：最近关注"温馨氛围"、"复古风格"的电影

#### 1.3 用户-电影交互图
- **边类型**：基于评分构建交互类型
  - 高评分（4-5星）→ 正向交互（喜欢）
  - 中评分（3星）→ 中性交互
  - 低评分（1-2星）→ 负向交互（不喜欢）
- **正负边区分**：明确区分正负交互，用于监督学习
- **时间信息**：保留评分时间戳，区分长期兴趣和短期兴趣

### 2. 推荐模型设计（在线阶段 - 使用轻量GNN）

#### 2.1 双阶段图学习策略

**第一阶段：三张图分别建模**
- 用户侧图：学习基于兴趣标签聚合的用户表示
- 物品侧图：学习基于属性标签聚合的物品表示
- 用户-物品交互图：监督学习，对正负交互进行区分建模

**第二阶段：统一融合图建模**
- 构建包含所有实体（user/item/knowledge point）的融合图
- 使用图神经网络进行进一步传播和建模
- 利用知识点连接的路径提升user-item之间的表示交互

#### 2.2 模型增强设计

- **Relation-aware Attention**：对不同类型边赋予不同的注意力权重，正向兴趣传播增强，负向行为传播抑制
- **对比学习目标**：构造(user, pos_item, neg_item)三元组，拉近兴趣一致项、推远负反馈项
- **图结构嵌入损失**：正边节点靠近，负边节点拉远，知识点聚合连接节点形成聚类中心

#### 2.3 可解释性设计

- 基于路径的推荐解释：例如"推荐《少年时代》是因为你近期关注'成长题材'，该片属于'成长题材'和'纪录片风格'"
- 用户画像：输出用户兴趣标签占比

## 核心挑战与解决方案

### 挑战1：知识点内容标准化

**问题**：
- 虽然限制了知识点类型，但未限制知识点内容
- 大模型对同一含义存在多种表述，需统一为一定数目的知识点内容

**已尝试的方案**：
1. ✅ BERTopic + HDBSCAN（demo效果好，全量数据效果差）
2. ✅ BGE模型 + K-means（效果相对较优，但仍有强制分类问题）

**当前方案**：
- 对部分电影（如5%，约200部）进行不加限制地生成
- 对这些电影的知识点采用聚类方式，调参得到每个类上一定数目的知识点类型&内容
- 在全量生成时，限制为/投影为已经确定的知识点类型&内容

### 挑战2：增量更新

**问题**：传统聚类方法在新电影加入时需要完全更新聚类结果

**解决思路**：预先确定知识点schema，新电影的知识点投影到已有知识点集合

### 挑战3：多模态知识融合

**问题**：如何有效融合文本知识（标题、类型）和视觉知识（海报）

**解决思路**：
- 使用多模态LLM（如GPT-4V、Claude 3）同时处理文本和图像
- 设计统一的知识点schema，融合不同模态的知识抽取结果

## 项目结构

```
llm-knowledge-extraction-rec/
├── data/                          # 数据目录（用户自行下载）
│   ├── raw/                       # 原始数据
│   ├── processed/                 # 处理后的数据
│   └── graphs/                    # 生成的图谱数据
├── src/                           # 源代码
│   ├── data_processing/           # 数据处理模块
│   ├── knowledge_extraction/      # 知识抽取模块
│   ├── clustering/                # 聚类模块
│   ├── graph_construction/        # 图谱构建模块
│   ├── models/                    # 推荐模型
│   └── utils/                     # 工具函数
├── configs/                       # 配置文件
├── notebooks/                     # Jupyter notebooks（实验和分析）
├── scripts/                       # 运行脚本
├── tests/                         # 测试代码
├── requirements.txt               # Python依赖
└── README.md                      # 项目说明
```

## 当前进展

### ✅ 已完成（原型阶段 - 基于Amazon VideoGames）

1. 商品知识点抽取（demo验证）
2. 用户兴趣抽取
3. 基于大模型抽取知识图谱的图推荐全流程

### 🚧 进行中（迁移到MovieLens 1M）

1. 切换到MovieLens 1M数据集
2. 设计电影领域的知识点类型schema
3. 搭建完整的项目代码框架

### 📋 待完成

1. 构建初步图谱
2. 搭建三图建模和对比学习框架
3. 实现路径可解释性
4. 性能评估和case study

## 技术栈

- **LLM**：用于知识抽取（离线）
- **Embedding模型**：BGE / BERTopic
- **聚类算法**：HDBSCAN / K-means
- **图神经网络**：PyTorch Geometric
- **知识图谱存储**：Neo4j / NetworkX
- **推荐框架**：PyTorch

## 快速开始

```bash
# 1. 克隆仓库
git clone <repository-url>
cd llm-knowledge-extraction-rec

# 2. 安装依赖
pip install -r requirements.txt

# 3. 下载数据
python scripts/download_data.py

# 4. 运行知识抽取
python scripts/extract_knowledge.py

# 5. 构建图谱
python scripts/build_graph.py

# 6. 训练推荐模型
python scripts/train_recommender.py
```

## 参考文献

相关工作和论文引用（待补充）

## 许可证

MIT License

## 更新日志

### 2024-07-25
- 在全量数据上进行知识点抽取实验
- 尝试BGE模型和K-means聚类方法
- 探索知识点内容标准化方案

### 2024-07-17
- 完成Demo全流程实验（200+商品）
- 实现10类知识点类型限制
- 实现基于Graph RAG的用户兴趣抽取

### 2024-07-03
- 设计整体流程
- 提出双阶段图学习策略

### 2024-07-01
- 项目启动
- 完成方法构想和技术方案设计
